<!DOCTYPE html>
<html lang="pa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Duty Roster - ਸ੍ਰੀ ਹਰਿਮੰਦਰ ਸਾਹਿਬ</title>
    
    <!-- PWA Settings for Fullscreen -->
    <meta name="theme-color" content="#ea580c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Duty Roster">

    <!-- Inline Manifest Generator -->
    <link rel="manifest" id="manifest-placeholder">

    <style>
        :root {
            --primary: #ea580c; /* Orange */
            --primary-light: #fff7ed;
            --secondary: #1e40af; /* Blue */
            --secondary-light: #eff6ff;
            --bg: #fffbeb;
            --text: #1f2937;
            --border: #e5e7eb;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 0;
            color: var(--text);
            overscroll-behavior-y: contain;
            padding-bottom: 80px;
        }

        /* Container */
        .app-container {
            max-width: 480px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            background-color: var(--primary);
            color: white;
            padding: 20px 20px 25px 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        header h1 { margin: 0; font-size: 1.4rem; padding-top: 5px; }
        header h2 { margin: 4px 0 0; font-size: 1rem; opacity: 0.9; font-weight: normal; }

        /* Full Screen Button - Top Right Corner */
        #fullscreen-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 8px;
            font-size: 0.75rem; /* Small font */
            cursor: pointer;
            display: none; /* Hidden by default */
            line-height: 1;
            font-weight: bold;
            transition: background 0.2s;
        }
        #fullscreen-btn:active {
            background: rgba(255, 255, 255, 0.4);
        }

        /* Controls */
        .controls { padding: 20px; }
        .form-group { margin-bottom: 20px; }
        .label { display: block; font-weight: 600; margin-bottom: 8px; color: #4b5563; }
        
        input[type="date"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            appearance: none; /* Remove default styling */
        }

        /* Shift Buttons */
        .shift-toggles { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .shift-btn {
            padding: 15px;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .shift-btn.active-evening {
            background-color: var(--primary-light);
            border-color: var(--primary);
            color: #9a3412;
            box-shadow: 0 0 0 2px var(--primary);
        }
        .shift-btn.active-morning {
            background-color: var(--secondary-light);
            border-color: var(--secondary);
            color: var(--secondary);
            box-shadow: 0 0 0 2px var(--secondary);
        }

        /* Action Buttons */
        .actions { display: flex; gap: 10px; margin-top: 10px; }
        .btn {
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn-reset { background-color: #e5e7eb; color: #374151; flex: 1; }
        .btn-calc { background-color: var(--secondary); color: white; flex: 2; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn:active { transform: scale(0.98); }

        /* Results */
        #results-area { background-color: #f9fafb; border-top: 1px solid var(--border); padding: 20px; display: none; }
        .result-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
            border-left-width: 5px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .card-evening { border-left-color: var(--primary); background-color: #fffaf0; }
        .card-morning { border-left-color: var(--secondary); background-color: #f0f9ff; }

        .date-text { font-size: 1.1rem; font-weight: bold; color: #111827; }
        .shift-header { display: flex; align-items: center; gap: 6px; margin-top: 4px; font-weight: 600; font-size: 0.95rem; }
        .text-evening { color: #c2410c; }
        .text-morning { color: #1e3a8a; }

        .time-box {
            background: #f3f4f6;
            padding: 8px;
            border-radius: 4px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: #4b5563;
        }

        .rest-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        .rest-short { background: #f3f4f6; color: #6b7280; }
        .rest-long { background: #dcfce7; color: #166534; }

        /* SVG Icons */
        .icon { width: 20px; height: 20px; }
        .icon-lg { width: 24px; height: 24px; }
    </style>
</head>
<body>

    <div class="app-container">
        <header>
            <button id="fullscreen-btn" onclick="toggleFullScreen()" title="Full Screen">
                ⛶
            </button>
            <h1>ਸ੍ਰੀ ਹਰਿਮੰਦਰ ਸਾਹਿਬ</h1>
            <h2>ਡਿਊਟੀ ਰੋਸਟਰ (ਹਿਸਾਬ)</h2>
        </header>

        <div class="controls">
            <!-- Date Input -->
            <div class="form-group">
                <label class="label">ਸ਼ੁਰੂਆਤੀ ਤਾਰੀਖ ਚੁਣੋ:</label>
                <input type="date" id="start-date">
            </div>

            <!-- Shift Select -->
            <div class="form-group">
                <label class="label">ਪਹਿਲੀ ਡਿਊਟੀ ਕਿਹੜੀ ਹੈ?</label>
                <div class="shift-toggles">
                    <div class="shift-btn active-evening" id="btn-evening" onclick="selectShift('evening')">
                        <!-- Sun Icon -->
                        <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                        <span style="margin-top:5px; font-weight:600;">ਸ਼ਾਮ (3 PM)</span>
                    </div>
                    <div class="shift-btn" id="btn-morning" onclick="selectShift('morning')">
                        <!-- Moon Icon -->
                        <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                        <span style="margin-top:5px; font-weight:600;">ਸਵੇਰ (2:45 AM)</span>
                    </div>
                </div>
            </div>

            <!-- Buttons -->
            <div class="actions">
                <button class="btn btn-reset" onclick="resetApp()">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="1 4 1 10 7 10"></polyline><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path></svg>
                    ਰੀਸੈੱਟ
                </button>
                <button class="btn btn-calc" onclick="calculateSchedule()">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                    ਹਿਸਾਬ ਲਗਾਓ
                </button>
            </div>
        </div>

        <div id="results-area">
            <h3 style="margin-top:0; color:#374151;">ਅਗਲੇ 30 ਦਿਨਾਂ ਦਾ ਵੇਰਵਾ:</h3>
            <div id="schedule-list"></div>
            <div style="text-align:center; color:#9ca3af; margin-top:20px; font-size:0.8rem;">ਸੇਵਾ ਅਤੇ ਸਿਮਰਨ</div>
        </div>
    </div>

    <script>
        // --- DATA & STATE ---
        const daysInPunjabi = ['ਐਤਵਾਰ', 'ਸੋਮਵਾਰ', 'ਮੰਗਲਵਾਰ', 'ਬੁੱਧਵਾਰ', 'ਵੀਰਵਾਰ', 'ਸ਼ੁੱਕਰਵਾਰ', 'ਸ਼ਨੀਵਾਰ'];
        const monthsInPunjabi = ['ਜਨਵਰੀ', 'ਫਰਵਰੀ', 'ਮਾਰਚ', 'ਅਪ੍ਰੈਲ', 'ਮਈ', 'ਜੂਨ', 'ਜੁਲਾਈ', 'ਅਗਸਤ', 'ਸਤੰਬਰ', 'ਅਕਤੂਬਰ', 'ਨਵੰਬਰ', 'ਦਸੰਬਰ'];
        
        let currentShiftSelection = 'evening';

        // --- INIT ---
        window.onload = function() {
            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            
            // Load from LocalStorage
            const savedDate = localStorage.getItem('duty_date');
            const savedShift = localStorage.getItem('duty_shift');
            const savedSchedule = localStorage.getItem('duty_schedule_html');

            document.getElementById('start-date').value = savedDate || today;
            if(savedShift) selectShift(savedShift);

            // Restore previous calculation if exists
            if(savedSchedule) {
                document.getElementById('schedule-list').innerHTML = savedSchedule;
                document.getElementById('results-area').style.display = 'block';
            }

            // Show fullscreen button if not in standalone mode
            // Basic check: if not running in standalone mode (PWA), show the button
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
            if (!isStandalone) {
                document.getElementById('fullscreen-btn').style.display = 'block';
            }

            // Generate Manifest dynamically
            generateManifest();
        };

        // --- FUNCTIONS ---

        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    // console.log(`Error attempting to enable full-screen mode: ${err.message}`);
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        function selectShift(shift) {
            currentShiftSelection = shift;
            const btnEve = document.getElementById('btn-evening');
            const btnMorn = document.getElementById('btn-morning');

            if(shift === 'evening') {
                btnEve.className = 'shift-btn active-evening';
                btnMorn.className = 'shift-btn';
            } else {
                btnEve.className = 'shift-btn';
                btnMorn.className = 'shift-btn active-morning';
            }
        }

        function formatDatePunjabi(dateObj) {
            const dayName = daysInPunjabi[dateObj.getDay()];
            const date = dateObj.getDate();
            const monthName = monthsInPunjabi[dateObj.getMonth()];
            const year = dateObj.getFullYear();
            return `${dayName}, ${date} ${monthName} ${year}`;
        }

        function calculateSchedule() {
            const startDateVal = document.getElementById('start-date').value;
            if(!startDateVal) return;

            let currentDate = new Date(startDateVal);
            let currentShift = currentShiftSelection;
            let html = '';

            for (let i = 0; i < 30; i++) {
                let shiftData = {};

                if (currentShift === 'evening') {
                    shiftData = {
                        title: 'ਸ਼ਾਮ ਦੀ ਡਿਊਟੀ',
                        time: '3:00 PM (ਸ਼ਾਮ) - 9:00 PM (ਰਾਤ)',
                        rest: 'ਇਸ ਤੋਂ ਬਾਅਦ ਛੋਟੀ ਰੈਸਟ',
                        restClass: 'rest-short',
                        cardClass: 'card-evening',
                        textClass: 'text-evening',
                        icon: `<svg class="icon" style="margin-right:5px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>`
                    };
                } else {
                    shiftData = {
                        title: 'ਅੰਮ੍ਰਿਤ ਵੇਲਾ ਡਿਊਟੀ',
                        time: '2:45 AM (ਸਵੇਰੇ) - 9:00 AM (ਸਵੇਰੇ)',
                        rest: 'ਇਸ ਤੋਂ ਬਾਅਦ 30 ਘੰਟੇ ਦੀ ਵੱਡੀ ਰੈਸਟ',
                        restClass: 'rest-long',
                        cardClass: 'card-morning',
                        textClass: 'text-morning',
                        icon: `<svg class="icon" style="margin-right:5px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`
                    };
                }

                html += `
                    <div class="result-card ${shiftData.cardClass}">
                        <div class="date-text">${formatDatePunjabi(currentDate)}</div>
                        <div class="shift-header ${shiftData.textClass}">
                            ${shiftData.icon} ${shiftData.title}
                        </div>
                        <div class="time-box">
                            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                            ${shiftData.time}
                        </div>
                        <span class="rest-badge ${shiftData.restClass}">${shiftData.rest}</span>
                    </div>
                `;

                // Logic: Next day, toggle shift
                currentDate.setDate(currentDate.getDate() + 1);
                currentShift = currentShift === 'evening' ? 'morning' : 'evening';
            }

            const listEl = document.getElementById('schedule-list');
            listEl.innerHTML = html;
            document.getElementById('results-area').style.display = 'block';

            // Save to storage
            localStorage.setItem('duty_date', startDateVal);
            localStorage.setItem('duty_shift', currentShiftSelection);
            localStorage.setItem('duty_schedule_html', html);

            // Scroll to results
            document.getElementById('results-area').scrollIntoView({ behavior: 'smooth' });
        }

        function resetApp() {
            document.getElementById('start-date').value = new Date().toISOString().split('T')[0];
            selectShift('evening');
            document.getElementById('schedule-list').innerHTML = '';
            document.getElementById('results-area').style.display = 'none';
            
            localStorage.removeItem('duty_date');
            localStorage.removeItem('duty_shift');
            localStorage.removeItem('duty_schedule_html');
        }

        function generateManifest() {
            const manifest = {
                "name": "Duty Roster App",
                "short_name": "Duty Roster",
                "start_url": ".",
                "display": "standalone",
                "orientation": "portrait",
                "background_color": "#ffffff",
                "theme_color": "#ea580c",
                "icons": [
                    {
                        "src": "https://cdn-icons-png.flaticon.com/512/2693/2693507.png",
                        "sizes": "192x192",
                        "type": "image/png"
                    }
                ]
            };
            const stringManifest = JSON.stringify(manifest);
            const blob = new Blob([stringManifest], {type: 'application/json'});
            const manifestURL = URL.createObjectURL(blob);
            document.querySelector('#manifest-placeholder').setAttribute('href', manifestURL);
        }
    </script>

    <!-- Simple Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            const swCode = `
                const CACHE_NAME = 'duty-roster-vanilla-v2';
                self.addEventListener('install', e => e.waitUntil(caches.open(CACHE_NAME).then(c => c.add('.'))));
                self.addEventListener('fetch', e => e.respondWith(caches.match(e.request).then(r => r || fetch(e.request))));
            `;
            const blob = new Blob([swCode], {type: 'application/javascript'});
            navigator.serviceWorker.register(URL.createObjectURL(blob)).catch(console.error);
        }
    </script>
</body>
</html>


